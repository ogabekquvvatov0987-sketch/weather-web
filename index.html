<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Weather App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
    /* Kunduzgi rejim (Default - Ko'k) */
    --bg-gradient: linear-gradient(135deg, #4facfe, #00f2fe);
    --text-color: #fff;
    --glass-bg: rgba(255, 255, 255, 0.25);
    --glass-border: rgba(255, 255, 255, 0.4);
    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    --input-bg: rgba(255, 255, 255, 0.3);
    --btn-bg: rgba(0, 120, 255, 0.7);
}

body.dark-mode {
    /* Tun rejimi (Qora) */
    --bg-gradient: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    --text-color: #e0e0e0;
    --glass-bg: rgba(0, 0, 0, 0.3);
    --glass-border: rgba(255, 255, 255, 0.1);
    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    --input-bg: rgba(255, 255, 255, 0.1);
    --btn-bg: rgba(0, 0, 0, 0.5);
}

body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg-gradient);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: var(--text-color);
    overflow: hidden;
    transition: background 0.5s ease;
}

/* Asosiy konteyner (Device wrapper) */
#app-wrapper {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    position: relative;
    overflow: hidden;
}

/* Telefon rejimi */
#app-wrapper.mobile-mode {
    width: 375px;
    height: 812px;
    border-radius: 40px;
    border: 12px solid #333;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    background: var(--bg-gradient); /* Ichki fon */
    overflow-y: auto; /* Scroll bo'lishi uchun */
}

/* Telefon rejimida ichki elementlarni moslashtirish */
#app-wrapper.mobile-mode .card {
    width: 85%; /* Kichikroq kenglik */
    padding: 15px;
    margin-top: 40px; /* Tepadan joy */
}
#app-wrapper.mobile-mode h1 { font-size: 28px; margin: 5px 0; }
#app-wrapper.mobile-mode h2 { font-size: 18px; margin-bottom: 10px; }
#app-wrapper.mobile-mode input { width: 100%; font-size: 14px; padding: 10px; box-sizing: border-box; }
#app-wrapper.mobile-mode button { font-size: 14px; padding: 10px 15px; }
#app-wrapper.mobile-mode .details-grid { grid-template-columns: 1fr; gap: 5px; font-size: 13px; }
#app-wrapper.mobile-mode .input-group { flex-direction: row; width: 100%; }
}

/* Glassmorphism Card */
.card {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
    padding: 30px;
    border-radius: 25px;
    text-align: center;
    width: 85%;
    max-width: 320px;
    transition: all 0.3s ease;
}

h1 { margin: 10px 0; font-size: 40px; font-weight: 700; }
h2 { margin-bottom: 20px; font-weight: 600; }

.input-group {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    width: 100%;
}

input {
    padding: 12px;
    width: 60%;
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    background: var(--input-bg);
    color: var(--text-color);
    outline: none;
    font-size: 16px;
    transition: 0.3s;
}
input::placeholder { color: var(--text-color); opacity: 0.7; }

button {
    padding: 12px 25px;
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    background: var(--btn-bg);
    color: white;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    backdrop-filter: blur(5px);
    transition: transform 0.2s, background 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
button:active { transform: scale(0.95); }

.location-btn {
    background: rgba(46, 204, 113, 0.6); /* Yashilroq rang */
    padding: 12px;
}

/* Sozlamalar Paneli (Sidebar) */
.settings-panel {
    position: fixed;
    right: 20px;
    top: 20px;
    background: var(--glass-bg);
    backdrop-filter: blur(15px);
    padding: 15px;
    border-radius: 20px;
    border: 1px solid var(--glass-border);
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 1000;
    box-shadow: var(--glass-shadow);
}

.settings-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.settings-label {
    font-size: 12px;
    opacity: 0.8;
    text-align: center;
}

.icon-btn {
    background: rgba(255,255,255,0.2);
    padding: 8px;
    border-radius: 10px;
    font-size: 14px;
    width: 100%;
}
.icon-btn.active {
    background: var(--btn-bg);
    border: 1px solid white;
}

.details-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 20px;
    font-size: 14px;
    text-align: left;
    background: rgba(0,0,0,0.1);
    padding: 15px;
    border-radius: 15px;
}
</style>
</head>
<body>

<!-- Sozlamalar Paneli -->
<div class="settings-panel">
    <div class="settings-group">
        <span class="settings-label" id="lbl_device">Qurilma</span>
        <button class="icon-btn active" onclick="setDevice('desktop')" id="btn_desktop">üíª</button>
        <button class="icon-btn" onclick="setDevice('mobile')" id="btn_mobile">üì±</button>
    </div>
    <div class="settings-group">
        <span class="settings-label" id="lbl_theme">Mavzu</span>
        <button class="icon-btn" onclick="toggleTheme()" id="btn_theme">üåô / ‚òÄÔ∏è</button>
    </div>
    <div class="settings-group">
        <span class="settings-label" id="lbl_lang">Til</span>
        <button class="icon-btn" onclick="setLang('uz')">üá∫üáø UZ</button>
        <button class="icon-btn" onclick="setLang('ru')">üá∑üá∫ RU</button>
        <button class="icon-btn" onclick="setLang('en')">üá¨üáß EN</button>
    </div>
</div>

<!-- Asosiy Ilova -->
<div id="app-wrapper">
    <div class="card">
        <h2 id="app_title">üå§ Ob-havo</h2>
        <div class="input-group">
            <input type="text" id="city" placeholder="Shahar nomi">
            <button class="location-btn" onclick="getLocation()" id="btn_loc">üìç</button>
        </div>
        <button onclick="getWeather()" id="btn_check">Ko‚Äòrish</button>
        <div id="result"></div>
    </div>
</div>

<script>
const apiKey = "OPENWEATHER_API_KEYINGIZ";

// Tarjimalar
const translations = {
    uz: {
        title: "üå§ Ob-havo",
        placeholder: "Shahar nomi...",
        btn: "Ko‚Äòrish",
        device: "Qurilma",
        theme: "Mavzu",
        lang: "Til",
        error_empty: "‚ùó Shahar nomini kiriting",
        error_not_found: "‚ùå Shahar topilmadi",
        error_net: "‚ö† Internet xatosi",
        humidity: "Namlik",
        wind: "Shamol",
        feels_like: "His qilinishi",
        pressure: "Bosim",
        loc_access: "üìç Joylashuvni aniqlash...",
        loc_denied: "‚ùå Joylashuvga ruxsat berilmadi"
    },
    ru: {
        title: "üå§ –ü–æ–≥–æ–¥–∞",
        placeholder: "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞...",
        btn: "–ü–æ–∫–∞–∑–∞—Ç—å",
        device: "–£—Å—Ç—Ä-–≤–æ",
        theme: "–¢–µ–º–∞",
        lang: "–Ø–∑—ã–∫",
        error_empty: "‚ùó –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",
        error_not_found: "‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω",
        error_net: "‚ö† –û—à–∏–±–∫–∞ —Å–µ—Ç–∏",
        humidity: "–í–ª–∞–∂–Ω–æ—Å—Ç—å",
        wind: "–í–µ—Ç–µ—Ä",
        feels_like: "–û—â—É—â–∞–µ—Ç—Å—è",
        pressure: "–î–∞–≤–ª–µ–Ω–∏–µ",
        loc_access: "üìç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è...",
        loc_denied: "‚ùå –î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω"
    },
    en: {
        title: "üå§ Weather",
        placeholder: "City name...",
        btn: "Check",
        device: "Device",
        theme: "Theme",
        lang: "Lang",
        error_empty: "‚ùó Enter city name",
        error_not_found: "‚ùå City not found",
        error_net: "‚ö† Network error",
        humidity: "Humidity",
        wind: "Wind",
        feels_like: "Feels like",
        pressure: "Pressure",
        loc_access: "üìç Locating...",
        loc_denied: "‚ùå Location denied"
    }
};

let currentLang = 'uz';

function setLang(lang) {
    currentLang = lang;
    const t = translations[lang];
    
    document.getElementById('app_title').innerText = t.title;
    document.getElementById('city').placeholder = t.placeholder;
    document.getElementById('btn_check').innerText = t.btn;
    document.getElementById('lbl_device').innerText = t.device;
    document.getElementById('lbl_theme').innerText = t.theme;
    document.getElementById('lbl_lang').innerText = t.lang;
    
    // Agar natija ko'rsatilgan bo'lsa, uni tozalash yoki yangilash mumkin
    document.getElementById('result').innerHTML = "";
}

function setDevice(mode) {
    const wrapper = document.getElementById('app-wrapper');
    const btnDesktop = document.getElementById('btn_desktop');
    const btnMobile = document.getElementById('btn_mobile');

    if (mode === 'mobile') {
        wrapper.classList.add('mobile-mode');
        btnMobile.classList.add('active');
        btnDesktop.classList.remove('active');
    } else {
        wrapper.classList.remove('mobile-mode');
        btnDesktop.classList.add('active');
        btnMobile.classList.remove('active');
    }
}

function toggleTheme() {
    document.body.classList.toggle('dark-mode');
}

// Joylashuvni aniqlash
function getLocation() {
    const resultDiv = document.getElementById("result");
    const t = translations[currentLang];
    
    if (navigator.geolocation) {
        resultDiv.innerHTML = t.loc_access;
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                fetchWeather(lat, lon, true);
            },
            (error) => {
                resultDiv.innerHTML = t.loc_denied;
            }
        );
    } else {
        resultDiv.innerHTML = "Geolocation is not supported by this browser.";
    }
}

async function getWeather() {
    const city = document.getElementById("city").value;
    const resultDiv = document.getElementById("result");
    const t = translations[currentLang];

    if (!city) {
        // Agar shahar yozilmagan bo'lsa, avtomatik joylashuvni so'rash
        getLocation();
        return;
    }
    
    fetchWeather(city, null, false);
}

async function fetchWeather(query, lon, isCoords) {
    const resultDiv = document.getElementById("result");
    const t = translations[currentLang];
    
    let url = "";
    if (isCoords) {
        url = `https://api.openweathermap.org/data/2.5/weather?lat=${query}&lon=${lon}&appid=${apiKey}&units=metric&lang=${currentLang}`;
    } else {
        url = `https://api.openweathermap.org/data/2.5/weather?q=${query}&appid=${apiKey}&units=metric&lang=${currentLang}`;
    }

    try {
        const response = await fetch(url);

        if (!response.ok) {
            if (!isCoords) {
                resultDiv.innerHTML = `${t.error_not_found}<br><br><button class="location-btn" onclick="getLocation()" style="width:100%">${t.loc_access.replace('...', '')}</button>`;
            } else {
                // Agar koordinata bilan topilmasa, API xatosi bo'lishi mumkin
                resultDiv.innerHTML = `${t.error_not_found} (API)`;
            }
            return;
        }

        const data = await response.json();
        
        // Quyosh chiqishi va botishi vaqtini formatlash
        const sunrise = new Date(data.sys.sunrise * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const sunset = new Date(data.sys.sunset * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

        resultDiv.innerHTML = `
            <h2>${data.name}, ${data.sys.country}</h2>
            <h1>${Math.round(data.main.temp)}¬∞C</h1>
            <p>${data.weather[0].description}</p>
            
            <div class="details-grid">
                <div>üíß ${t.humidity}: ${data.main.humidity}%</div>
                <div>üí® ${t.wind}: ${data.wind.speed} m/s</div>
                <div>üå° ${t.feels_like}: ${Math.round(data.main.feels_like)}¬∞C</div>
                <div>‚è≤ ${t.pressure}: ${data.main.pressure} hPa</div>
                <div>üåÖ ${sunrise}</div>
                <div>üåá ${sunset}</div>
            </div>
        `;

    } catch (error) {
        resultDiv.innerHTML = t.error_net;
        console.error(error);
    }
}

// Boshlang'ich sozlamalar
setLang('uz');
</script>

</body>
</html>
